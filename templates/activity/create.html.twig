{% extends 'base.html.twig' %}

{% block title %}Créer une sortie{% endblock %}
{%  block h2 %}Créer une sortie{% endblock %}

{% block body %}


    {{ form_start(form) }}
        <div>
            {{ form_label(form.activityName) }}
            {{ form_widget(form.activityName) }}
            {{ form_errors(form.activityName) }}
        </div>

        <div>
            {{ form_label(form.startDate) }}
            {{ form_widget(form.startDate) }}
            {{ form_errors(form.startDate) }}
        </div>

        <div>
            {{ form_label(form.closingDate) }}
            {{ form_widget(form.closingDate) }}
            {{ form_errors(form.closingDate) }}
        </div>

        <div>
            {{ form_label(form.maxRegistration) }}
            {{ form_widget(form.maxRegistration) }}
            {{ form_errors(form.maxRegistration) }}
        </div>

        <div>
            {{ form_label(form.duration) }}
            {{ form_widget(form.duration) }}
            {{ form_errors(form.duration) }}
        </div>
        <div>
            {{ form_label(form.description) }}
            {{ form_widget(form.description) }}
            {{ form_errors(form.description) }}
        </div>

{#        <div>#}
{#            {{ form_label(form.pictureUrl) }}#}
{#            {{ form_widget(form.pictureUrl) }}#}
{#            {{ form_errors(form.pictureUrl) }}#}
{#        </div>#}

        <div>
            {{ form_label(form.site) }}
            {{ form_widget(form.site, {'attr': {'default': app.user.userProfile.site.id}})}}
            {{ form_errors(form.site) }}
        </div>

        <div>
            {{ form_label(form.city) }}
            {{ form_widget(form.city,{'attr': {'id': 'select-city'}}) }}
            {{ form_errors(form.city) }}
        </div>
        <div>
            {{ form_label(form.location) }}
            {{ form_widget(form.location,{'attr': {'id': 'select-location'}}) }}
            {{ form_errors(form.location) }}
            <a href="{{ path("activity_location_create")}}" class="btn btn-primary">+</a>
        </div>

        <div>
            <button type="submit" class="btn btn-success" name="btnActivity" value="add">Publier la sortie</button>
            <button type="submit" class="btn btn-info" name="btnActivity" value="save">Enregistrer comme brouillon</button>
            <a href="{{ path("activity_list") }}" class="btn btn-secondary">Annuler</a>
            {% if activity.state is not null and activity.state.id == 1  %}
                <a href="{{ path("activity_delete",{'id': activity.id}) }}" onclick="deleteEvent(event)" class="btn btn-danger">Supprimer</a>
            {% endif %}

        </div>
    {{ form_end(form) }}

    <script>
        window.onload = () => {
            let city = document.querySelector("#activity_city");
            city.addEventListener("change", function() {
                let form = this.closest("form");
                let data = new FormData(form);
                fetch(form.action, {
                    method: form.getAttribute("method"),
                    body: data,
                })
                    .then(response => response.text())
                    .then(html => {
                        let parser = new DOMParser();
                        let parsedHTML = parser.parseFromString(html, "text/html");
                        let nouveauSelect = parsedHTML.querySelector("#activity_location");
                        let existingSelect = document.querySelector("#activity_location");

                        if (existingSelect && nouveauSelect) {
                            existingSelect.parentNode.replaceChild(nouveauSelect, existingSelect);
                        }
                    });
            });
        };
    </script>
{% endblock %}

