{% extends 'base.html.twig' %}

{% block title %}Créer une sortied{% endblock %}
{%  block h2 %}Créer une sortie{% endblock %}

{% block body %}


    {{ form_start(form) }}
        <div>
            {{ form_label(form.activityName) }}
            {{ form_widget(form.activityName) }}
            {{ form_errors(form.activityName) }}
        </div>

        <div>
            {{ form_label(form.startDate) }}
            {{ form_widget(form.startDate) }}
            {{ form_errors(form.startDate) }}
        </div>

        <div>
            {{ form_label(form.closingDate) }}
            {{ form_widget(form.closingDate) }}
            {{ form_errors(form.closingDate) }}
        </div>

        <div>
            {{ form_label(form.maxRegistration) }}
            {{ form_widget(form.maxRegistration) }}
            {{ form_errors(form.maxRegistration) }}
        </div>

        <div>
            {{ form_label(form.duration) }}
            {{ form_widget(form.duration) }}
            {{ form_errors(form.duration) }}
        </div>
        <div>
            {{ form_label(form.description) }}
            {{ form_widget(form.description) }}
            {{ form_errors(form.description) }}
        </div>

{#        <div>#}
{#            {{ form_label(form.pictureUrl) }}#}
{#            {{ form_widget(form.pictureUrl) }}#}
{#            {{ form_errors(form.pictureUrl) }}#}
{#        </div>#}

        <div>
            {{ form_label(form.site) }}
            {{ form_widget(form.site, {'attr': {'default': app.user.userProfile.site.id}})}}
            {{ form_errors(form.site) }}
        </div>

        <div >
            {{ form_label(form.city) }}
            {{ form_widget(form.city,{'attr': {'id': 'select-city','onchange': 'changeLocation()'} }) }}
            {{ form_errors(form.city) }}
        </div>
        <div >
            {{ form_label(form.location) }}
            {{ form_widget(form.location,{'attr': {'id': 'select-location','onchange': 'locationDetails()'} }) }}
            {{ form_errors(form.location) }}
            <a href="{{ path("activity_location_create")}}" class="btn btn-primary">+</a>
        </div>
        <div id="location-details" style="display: none;">
            <p id="location-street"></p>
            <p id="location-latitude"></p>
            <p id="location-longitude"></p>
            <p id="city-postCode"> </p>
    </div>
        <div>
            <button type="submit" class="btn btn-success" name="btnActivity" value="add">Publier la sortie</button>
            <button type="submit" class="btn btn-info" name="btnActivity" value="save">Enregistrer comme brouillon</button>
            <a href="{{ path("activity_list") }}" class="btn btn-secondary">Annuler</a>
            {% if activity.state is not null and activity.state.id == 1  %}
                <a href="{{ path("activity_delete",{'id': activity.id}) }}" onclick="deleteEvent(event)" class="btn btn-danger">Supprimer</a>
            {% endif %}

        </div>
    {{ form_end(form) }}
    <script>
        window.onload;
        function changeLocation() {
            var citySelect = document.getElementById('activity_city');
            var locationSelect = document.getElementById('activity_location');
            var selectedCity = citySelect.value;
            locationSelect.innerHTML = '';
            {% for location in locations %}
                {% set locationId = location.id %}
                {% set locationName = location.locationName %}
                if (selectedCity === '{{ location.city.id }}') {
                var option = document.createElement('option');
                option.value = '{{ locationId }}';
                option.text = '{{ locationName }}';
                locationSelect.appendChild(option);
                }
            {% endfor %}

    }

    function locationDetails(){
        var citySelect = document.getElementById('activity_city');
        var locationSelect = document.getElementById('activity_location');
        var selectedLocation =locationSelect.value;

        var locationDetailsDiv = document.getElementById('location-details');
        var locationStreet = document.getElementById('location-street');
        var locationLatitude = document.getElementById('location-latitude');
        var locationLongitude= document.getElementById('location-longitude');
        var postCode= document.getElementById('city-postCode');

        locationDetailsDiv.style.display = 'none';

        {% for location in locations %}
        if ('{{ location.id }}' === selectedLocation) {
            locationStreet.textContent = 'Street: {{ location.street }}';
            locationLatitude.textContent = 'Latitude: {{ location.latitude }}';
            locationLongitude.textContent = 'Latitude: {{ location.longitude }}';
           postCode.textContent = 'Code Postale:{{ location.city.postCode }}';

            locationDetailsDiv.style.display = 'block';

        }
        {% endfor %}
    }

        window.onload = function() {
            locationDetails();
            changeLocation();


    }

    </script>

{% endblock %}

